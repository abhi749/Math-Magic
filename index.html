<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Math Magic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      background: #f4f7ff;
      color: #1f2933;
      min-height: 100vh;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      padding: 24px 12px;
    }

    .app {
      width: 100%;
      max-width: 950px;
      background: #ffffff;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.12);
      padding: 24px 20px 28px;
    }

    .app-header {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .title-block h1 {
      font-size: 1.8rem;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .title-block p {
      margin-top: 4px;
      color: #4b5563;
      font-size: 0.95rem;
    }

    .badge {
      background: #e0ecff;
      color: #1d4ed8;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .mascot-card {
      margin-top: 10px;
      display: flex;
      align-items: center;
      gap: 10px;
      background: #eff6ff;
      border-radius: 14px;
      padding: 8px 10px;
      border: 1px dashed #bfdbfe;
    }

    .mascot-emoji {
      font-size: 1.8rem;
    }

    .mascot-text {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .mascot-title {
      font-weight: 700;
      font-size: 0.95rem;
    }

    .mascot-subtitle {
      font-size: 0.85rem;
      color: #4b5563;
    }

    .top-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      margin-top: 14px;
      margin-bottom: 10px;
    }

    .tabs {
      display: inline-flex;
      border-radius: 999px;
      background: #e5e7eb;
      padding: 4px;
      gap: 4px;
    }

    .tab {
      border-radius: 999px;
      padding: 6px 14px;
      font-size: 0.85rem;
      border: none;
      cursor: pointer;
      background: transparent;
      font-weight: 500;
    }

    .tab.active {
      background: #2563eb;
      color: #ffffff;
    }

    .lang-select {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.85rem;
    }

    .lang-select label {
      color: #4b5563;
    }

    .lang-select select {
      padding: 4px 8px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      font-size: 0.85rem;
      background: #f9fafb;
    }

    .card {
      background: #f9fafb;
      border-radius: 14px;
      padding: 16px 16px 18px;
      margin-bottom: 16px;
      border: 1px solid #e5e7eb;
    }

    .card h2 {
      font-size: 1.1rem;
      margin-bottom: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .card p.subtitle {
      font-size: 0.9rem;
      color: #6b7280;
      margin-bottom: 12px;
    }

    .input-row {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      margin-bottom: 12px;
    }

    .field {
      flex: 1 1 140px;
      min-width: 0;
    }

    .field label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 4px;
      color: #374151;
      font-weight: 500;
    }

    .field input {
      width: 100%;
      padding: 8px 10px;
      border-radius: 10px;
      border: 1px solid #d1d5db;
      font-size: 1rem;
      outline: none;
      transition: border-color 0.15s, box-shadow 0.15s;
    }

    .field input:focus {
      border-color: #2563eb;
      box-shadow: 0 0 0 1px rgba(37, 99, 235, 0.2);
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }

    button.calculate-btn {
      background: #2563eb;
      color: white;
      border: none;
      border-radius: 999px;
      padding: 8px 20px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.1s, box-shadow 0.1s, background 0.1s;
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.35);
    }

    button.calculate-btn:hover {
      background: #1d4ed8;
      transform: translateY(-1px);
    }

    button.calculate-btn:active {
      transform: translateY(0);
      box-shadow: 0 3px 8px rgba(37, 99, 235, 0.4);
    }

    button.clear-btn {
      background: #f3f4f6;
      color: #374151;
      border: 1px solid #d1d5db;
      border-radius: 999px;
      padding: 8px 20px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.1s;
    }

    button.clear-btn:hover {
      background: #e5e7eb;
    }

    .mic-btn {
      background: #fef3c7;
      color: #92400e;
      border-radius: 999px;
      border: 1px solid #facc15;
      padding: 6px 14px;
      font-size: 0.85rem;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
    }

    .mic-btn[disabled] {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .hint-text {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .result-section {
      margin-top: 10px;
      border-radius: 12px;
      background: #eef2ff;
      border: 1px solid #c7d2fe;
      padding: 10px 12px;
      font-size: 0.95rem;
    }

    .result-main {
      font-weight: 600;
      margin-bottom: 6px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .result-main span.equation {
      font-family: "SF Mono", ui-monospace, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .result-sentence {
      font-size: 0.9rem;
      color: #374151;
      margin-bottom: 4px;
    }

    .factor-section {
      background: #f9fafb;
      border-radius: 12px;
      padding: 10px 12px;
      border: 1px dashed #d1d5db;
      font-size: 0.9rem;
    }

    .factor-section h3 {
      font-size: 0.95rem;
      margin-bottom: 6px;
    }

    .factor-list {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
    }

    .factor-item {
      display: flex;
      flex-wrap: wrap;
      gap: 4px;
      align-items: center;
    }

    .equation-pill {
      padding: 2px 8px;
      border-radius: 999px;
      background: #e5e7eb;
    }

    .multiply-details {
      background: #f9fafb;
      border-radius: 12px;
      padding: 10px 12px;
      margin-top: 10px;
      border: 1px dashed #d1d5db;
      font-size: 0.9rem;
    }

    .multiply-details h3 {
      font-size: 0.95rem;
      margin-bottom: 6px;
    }

    .multiply-details-list {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .detail-row {
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .error {
      margin-top: 6px;
      color: #b91c1c;
      font-size: 0.85rem;
    }

    @media (max-width: 600px) {
      .app {
        padding: 18px 14px 20px;
      }

      .title-block h1 {
        font-size: 1.4rem;
      }

      .top-controls {
        flex-direction: column;
        align-items: flex-start;
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <header class="app-header">
      <div class="title-block">
        <h1 id="appTitle">ü™Ñ Math Magic</h1>
        <p id="appSubtitle">Practice division and times tables with a friendly math buddy.</p>
      </div>
      <div class="badge">
        Built for kids 7‚Äì9 üëßüßëüß†
      </div>
    </header>

    <div class="mascot-card">
      <div class="mascot-emoji">üê®</div>
      <div class="mascot-text">
        <div class="mascot-title" id="mascotTitle">Hi, I'm Lavender!</div>
        <div class="mascot-subtitle" id="mascotSubtitle">
          I help you explore numbers, division, and multiplication. ‚ú®
        </div>
      </div>
    </div>

    <div class="top-controls">
      <div class="tabs">
        <button class="tab active" id="tabDivision" type="button">‚ûó Division</button>
        <button class="tab" id="tabMultiply" type="button">‚úñÔ∏è Times Tables</button>
      </div>
      <div class="lang-select">
        <label for="languageSelect" id="languageLabel">üåç Language</label>
        <select id="languageSelect">
          <option value="en">English</option>
          <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä (Hindi)</option>
        </select>
      </div>
    </div>

    <!-- DIVISION SECTION -->
    <section class="card" id="divisionSection">
      <h2 id="divisionTitle">Step 1: Enter your division problem ‚úèÔ∏è</h2>
      <p class="subtitle" id="divisionSubtitle">
        Choose a number to share and how many equal groups you want.
      </p>

      <div class="input-row">
        <div class="field">
          <label for="dividend" id="dividendLabel">Number to share (dividend)</label>
          <input type="number" id="dividend" placeholder="e.g. 100" min="1">
        </div>
        <div class="field">
          <label for="divisor" id="divisorLabel">Number of groups (divisor)</label>
          <input type="number" id="divisor" placeholder="e.g. 4" min="1">
        </div>
      </div>

      <div class="btn-row">
        <button class="calculate-btn" id="divisionCalcBtn" type="button">
          Calculate
        </button>
        <button class="clear-btn" id="divisionClearBtn" type="button">
          Clear
        </button>
        <button class="mic-btn" id="divisionMicBtn" type="button">
          üéô Speak division
        </button>
        <span class="hint-text" id="divisionHint">
          Try saying "100 divided by 4".
        </span>
      </div>

      <div id="divisionError" class="error" style="display:none;"></div>

      <div id="divisionResult" class="result-section" style="display:none;">
        <div class="result-main">
          <span id="divisionResultLabel">Result:</span>
          <span class="equation" id="divisionEquation"></span>
        </div>
        <div class="result-sentence" id="divisionStory"></div>
        <div class="result-sentence" id="divisionTimes"></div>
      </div>

      <div id="factors" class="factor-section" style="display:none; margin-top:10px;">
        <h3 id="factorTitle">All factor pairs of your number üîç</h3>
        <p style="margin-bottom:4px; font-size:0.85rem; color:#6b7280;" id="factorSubtitle">
          These are all the ways to multiply two whole numbers to reach your starting number.
        </p>
        <div id="factorList" class="factor-list"></div>
      </div>
    </section>

    <!-- MULTIPLICATION SECTION -->
    <section class="card" id="multiplySection" style="display:none;">
      <h2 id="multiplyTitle">Times tables: build a multiplication fact ‚úñÔ∏è</h2>
      <p class="subtitle" id="multiplySubtitle">
        Pick two numbers and see the multiplication. Great for practicing tables!
      </p>

      <div class="input-row">
        <div class="field">
          <label for="multiplicand" id="multiplicandLabel">First number</label>
          <input type="number" id="multiplicand" placeholder="e.g. 12" min="0">
        </div>
        <div class="field">
          <label for="multiplier" id="multiplierLabel">Second number</label>
          <input type="number" id="multiplier" placeholder="e.g. 7" min="0">
        </div>
      </div>

      <div class="btn-row">
        <button class="calculate-btn" id="multiplyCalcBtn" type="button">
          Calculate
        </button>
        <button class="clear-btn" id="multiplyClearBtn" type="button">
          Clear
        </button>
        <button class="mic-btn" id="multiplyMicBtn" type="button">
          üéô Speak times table
        </button>
        <span class="hint-text" id="multiplyHint">
          Try saying "12 times 7".
        </span>
      </div>

      <div id="multiplyError" class="error" style="display:none;"></div>

      <div id="multiplyResult" class="result-section" style="display:none;">
        <div class="result-main">
          <span id="multiplyResultLabel">Result:</span>
          <span class="equation" id="multiplyEquation"></span>
        </div>
        <div class="result-sentence" id="multiplyStory"></div>
      </div>

      <div id="multiplyDetails" class="multiply-details" style="display:none;">
        <h3 id="multiplyDetailsTitle">Understanding this multiplication üîç</h3>
        <div class="multiply-details-list" id="multiplyDetailsList"></div>
      </div>
    </section>
  </div>

  <script>
    // ---------- ELEMENT REFERENCES ----------
    const tabDivision = document.getElementById('tabDivision');
    const tabMultiply = document.getElementById('tabMultiply');
    const divisionSection = document.getElementById('divisionSection');
    const multiplySection = document.getElementById('multiplySection');

    const languageSelect = document.getElementById('languageSelect');

    // Division elements
    const dividendInput = document.getElementById('dividend');
    const divisorInput = document.getElementById('divisor');
    const divisionCalcBtn = document.getElementById('divisionCalcBtn');
    const divisionClearBtn = document.getElementById('divisionClearBtn');
    const divisionMicBtn = document.getElementById('divisionMicBtn');
    const divisionError = document.getElementById('divisionError');
    const divisionResult = document.getElementById('divisionResult');
    const divisionEquation = document.getElementById('divisionEquation');
    const divisionStory = document.getElementById('divisionStory');
    const divisionTimes = document.getElementById('divisionTimes');
    const factorsBox = document.getElementById('factors');
    const factorList = document.getElementById('factorList');

    // Multiplication elements
    const multiplicandInput = document.getElementById('multiplicand');
    const multiplierInput = document.getElementById('multiplier');
    const multiplyCalcBtn = document.getElementById('multiplyCalcBtn');
    const multiplyClearBtn = document.getElementById('multiplyClearBtn');
    const multiplyMicBtn = document.getElementById('multiplyMicBtn');
    const multiplyError = document.getElementById('multiplyError');
    const multiplyResult = document.getElementById('multiplyResult');
    const multiplyEquation = document.getElementById('multiplyEquation');
    const multiplyStory = document.getElementById('multiplyStory');
    const multiplyDetails = document.getElementById('multiplyDetails');
    const multiplyDetailsList = document.getElementById('multiplyDetailsList');

    // Text elements for translation
    const translations = {
      en: {
        appTitle: "ü™Ñ Math Magic",
        appSubtitle: "Practice division and times tables with a friendly math buddy.",
        mascotTitle: "Hi, I'm Lavender!",
        mascotSubtitle: "I help you explore numbers, division, and multiplication. ‚ú®",
        languageLabel: "üåç Language",
        divisionTitle: "Step 1: Enter your division problem ‚úèÔ∏è",
        divisionSubtitle: "Choose a number to share and how many equal groups you want.",
        dividendLabel: "Number to share (dividend)",
        divisorLabel: "Number of groups (divisor)",
        divisionHint: "Try saying \"100 divided by 4\".",
        divisionResultLabel: "Result:",
        factorTitle: "All factor pairs of your number üîç",
        factorSubtitle: "These are all the ways to multiply two whole numbers to reach your starting number.",
        multiplyTitle: "Times tables: build a multiplication fact ‚úñÔ∏è",
        multiplySubtitle: "Pick two numbers and see the multiplication. Great for practicing tables!",
        multiplicandLabel: "First number",
        multiplierLabel: "Second number",
        multiplyHint: "Try saying \"12 times 7\".",
        multiplyResultLabel: "Result:",
        multiplyDetailsTitle: "Understanding this multiplication üîç",
        errors: {
          bothNumbers: "Please enter both numbers.",
          positive: "Please use positive numbers greater than zero."
        },
        divisionStoryNoRemainder: (dividend, divisor, quotient) =>
          `If you share ${dividend} into ${divisor} equal groups, each group gets ${quotient}.`,
        divisionStoryRemainder: (dividend, divisor, quotient, remainder) =>
          `If you share ${dividend} into ${divisor} equal groups, each group gets ${quotient} and ${remainder} is left over.`,
        divisionTimesNoRemainder: (divisor, quotient, dividend) =>
          `${divisor} √ó ${quotient} = ${dividend}`,
        divisionTimesRemainder: (divisor, quotient, dividend) =>
          `Because there is a remainder, ${divisor} √ó ${quotient} is only ${divisor * quotient}, not ${dividend}.`,
        multiplyStory: (a, b, product) =>
          `${a} √ó ${b} = ${product}.`,
        multiplyDetailsCommutative: (a, b, product) => 
          `üìê Commutative property: ${a} √ó ${b} = ${b} √ó ${a} = ${product}`,
        multiplyDetailsRepeated: (a, b) =>
          `‚ûï Repeated addition: ${a} √ó ${b} means adding ${a} together ${b} times`,
        multiplyDetailsSkip: (a, b) =>
          `ü¶ò Skip counting: Count by ${a}s, ${b} times`,
        multiplyDetailsReverse: (product, a, b) =>
          `‚Ü©Ô∏è Division check: ${product} √∑ ${a} = ${b} and ${product} √∑ ${b} = ${a}`
      },
      hi: {
        appTitle: "ü™Ñ ‡§Æ‡•à‡§• ‡§Æ‡•à‡§ú‡§ø‡§ï",
        appSubtitle: "‡§Æ‡§ú‡§º‡•á‡§¶‡§æ‡§∞ ‡§§‡§∞‡•Ä‡§ï‡•á ‡§∏‡•á ‡§≠‡§æ‡§ó ‡§î‡§∞ ‡§™‡§π‡§æ‡§°‡§º‡•á ‡§ï‡•Ä ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡§∞‡•á‡§Ç‡•§",
        mascotTitle: "‡§®‡§Æ‡§∏‡•ç‡§§‡•á, ‡§Æ‡•à‡§Ç ‡§≤‡•à‡§µ‡•á‡§Ç‡§°‡§∞ ‡§π‡•Ç‡§Å!",
        mascotSubtitle: "‡§Æ‡•à‡§Ç ‡§§‡•Å‡§Æ‡•ç‡§π‡•á‡§Ç ‡§®‡§Ç‡§¨‡§∞, ‡§≠‡§æ‡§ó ‡§î‡§∞ ‡§ó‡•Å‡§£‡§æ ‡§∏‡•Ä‡§ñ‡§®‡•á ‡§Æ‡•á‡§Ç ‡§Æ‡§¶‡§¶ ‡§ï‡§∞‡§§‡§æ ‡§π‡•Ç‡§Å‡•§ ‚ú®",
        languageLabel: "üåç ‡§≠‡§æ‡§∑‡§æ",
        divisionTitle: "‡§ï‡§¶‡§Æ 1: ‡§Ö‡§™‡§®‡§æ ‡§≠‡§æ‡§ó ‡§ï‡§æ ‡§∏‡§µ‡§æ‡§≤ ‡§≤‡§ø‡§ñ‡•ã ‚úèÔ∏è",
        divisionSubtitle: "‡§ú‡§ø‡§∏ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§¨‡§æ‡§Å‡§ü‡§®‡§æ ‡§π‡•à ‡§î‡§∞ ‡§ï‡§ø‡§§‡§®‡•á ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§≠‡§æ‡§ó ‡§ö‡§æ‡§π‡§ø‡§è, ‡§µ‡•ã ‡§ö‡•Å‡§®‡•ã‡•§",
        dividendLabel: "‡§ú‡§ø‡§∏ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§¨‡§æ‡§Å‡§ü‡§®‡§æ ‡§π‡•à",
        divisorLabel: "‡§ï‡§ø‡§§‡§®‡•á ‡§≠‡§æ‡§ó (‡§ó‡•ç‡§∞‡•Å‡§™)",
        divisionHint: "‡§ê‡§∏‡•á ‡§¨‡•ã‡§≤‡§ï‡§∞ ‡§¶‡•á‡§ñ‡•ã: \"100 divided by 4\".",
        divisionResultLabel: "‡§â‡§§‡•ç‡§§‡§∞:",
        factorTitle: "‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•á ‡§∏‡§≠‡•Ä ‡§ó‡•Å‡§£‡§®‡§ñ‡§Ç‡§° üîç",
        factorSubtitle: "‡§Ø‡•á ‡§∏‡§≠‡•Ä ‡§§‡§∞‡•Ä‡§ï‡•á ‡§π‡•à‡§Ç ‡§ú‡§ø‡§®‡§∏‡•á ‡§¶‡•ã ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡•ã ‡§ó‡•Å‡§£‡§æ ‡§ï‡§∞‡§ï‡•á ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§¨‡§®‡§§‡•Ä ‡§π‡•à‡•§",
        multiplyTitle: "‡§™‡§π‡§æ‡§°‡§º‡•á: ‡§ó‡•Å‡§£‡§æ ‡§ï‡§æ ‡§∏‡§µ‡§æ‡§≤ ‡§¨‡§®‡§æ‡§ì ‚úñÔ∏è",
        multiplySubtitle: "‡§¶‡•ã ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ‡§è‡§Å ‡§ö‡•Å‡§®‡•ã ‡§î‡§∞ ‡§â‡§®‡§ï‡§æ ‡§ó‡•Å‡§£‡§æ ‡§¶‡•á‡§ñ‡•ã‡•§ ‡§™‡§π‡§æ‡§°‡§º‡§æ ‡§™‡•ç‡§∞‡•à‡§ï‡•ç‡§ü‡§ø‡§∏ ‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡§¢‡§º‡§ø‡§Ø‡§æ!",
        multiplicandLabel: "‡§™‡§π‡§≤‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ",
        multiplierLabel: "‡§¶‡•Ç‡§∏‡§∞‡•Ä ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ",
        multiplyHint: "‡§ê‡§∏‡•á ‡§¨‡•ã‡§≤‡§ï‡§∞ ‡§¶‡•á‡§ñ‡•ã: \"12 times 7\".",
        multiplyResultLabel: "‡§â‡§§‡•ç‡§§‡§∞:",
        multiplyDetailsTitle: "‡§á‡§∏ ‡§ó‡•Å‡§£‡§æ ‡§ï‡•ã ‡§∏‡§Æ‡§ù‡•á‡§Ç üîç",
        errors: {
          bothNumbers: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç‡•§",
          positive: "‡§ï‡•É‡§™‡§Ø‡§æ ‡§∂‡•Ç‡§®‡•ç‡§Ø ‡§∏‡•á ‡§¨‡§°‡§º‡•Ä ‡§ß‡§®‡§æ‡§§‡•ç‡§Æ‡§ï ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ ‡§ï‡§æ ‡§â‡§™‡§Ø‡•ã‡§ó ‡§ï‡§∞‡•á‡§Ç‡•§"
        },
        divisionStoryNoRemainder: (dividend, divisor, quotient) =>
          `${dividend} ‡§ï‡•ã ${divisor} ‡§¨‡§∞‡§æ‡§¨‡§∞ ‡§≠‡§æ‡§ó‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§Å‡§ü‡•ã‡§ó‡•á ‡§§‡•ã ‡§π‡§∞ ‡§≠‡§æ‡§ó ‡§Æ‡•á‡§Ç ${quotient} ‡§Ü‡§è‡§ó‡§æ‡•§`,
        divisionStoryRemainder: (dividend, divisor, quotient, remainder) =>
          `${dividend} ‡§ï‡•ã ${divisor} ‡§≠‡§æ‡§ó‡•ã‡§Ç ‡§Æ‡•á‡§Ç ‡§¨‡§æ‡§Å‡§ü‡•ã‡§ó‡•á ‡§§‡•ã ‡§π‡§∞ ‡§≠‡§æ‡§ó ‡§Æ‡•á‡§Ç ${quotient} ‡§Ü‡§è‡§ó‡§æ ‡§î‡§∞ ${remainder} ‡§¨‡§ö ‡§ú‡§æ‡§è‡§ó‡§æ‡•§`,
        divisionTimesNoRemainder: (divisor, quotient, dividend) =>
          `${divisor} √ó ${quotient} = ${dividend}`,
        divisionTimesRemainder: (divisor, quotient, dividend) =>
          `‡§ï‡•ç‡§Ø‡•ã‡§Ç‡§ï‡§ø ‡§¨‡§æ‡§ï‡•Ä ‡§¨‡§ö‡§§‡§æ ‡§π‡•à, ‡§á‡§∏‡§≤‡§ø‡§è ${divisor} √ó ${quotient} = ${divisor * quotient} ‡§π‡•à, ${dividend} ‡§®‡§π‡•Ä‡§Ç‡•§`,
        multiplyStory: (a, b, product) =>
          `${a} √ó ${b} = ${product}‡•§`,
        multiplyDetailsCommutative: (a, b, product) => 
          `üìê ‡§ï‡•ç‡§∞‡§Æ‡§µ‡§ø‡§®‡§ø‡§Æ‡•á‡§Ø ‡§ó‡•Å‡§£: ${a} √ó ${b} = ${b} √ó ${a} = ${product}`,
        multiplyDetailsRepeated: (a, b) =>
          `‚ûï ‡§¨‡§æ‡§∞-‡§¨‡§æ‡§∞ ‡§ú‡•ã‡§°‡§º‡§®‡§æ: ${a} √ó ${b} ‡§ï‡§æ ‡§Æ‡§§‡§≤‡§¨ ‡§π‡•à ${a} ‡§ï‡•ã ${b} ‡§¨‡§æ‡§∞ ‡§ú‡•ã‡§°‡§º‡§®‡§æ`,
        multiplyDetailsSkip: (a, b) =>
          `ü¶ò ‡§õ‡§≤‡§æ‡§Ç‡§ó ‡§ó‡§ø‡§®‡§§‡•Ä: ${a} ‡§ï‡•Ä ‡§õ‡§≤‡§æ‡§Ç‡§ó ‡§∏‡•á ${b} ‡§¨‡§æ‡§∞ ‡§ó‡§ø‡§®‡•ã`,
        multiplyDetailsReverse: (product, a, b) =>
          `‚Ü©Ô∏è ‡§≠‡§æ‡§ó ‡§∏‡•á ‡§ú‡§æ‡§Å‡§ö: ${product} √∑ ${a} = ${b} ‡§î‡§∞ ${product} √∑ ${b} = ${a}`
      }
    };

    const textIds = {
      appTitle: 'appTitle',
      appSubtitle: 'appSubtitle',
      mascotTitle: 'mascotTitle',
      mascotSubtitle: 'mascotSubtitle',
      languageLabel: 'languageLabel',
      divisionTitle: 'divisionTitle',
      divisionSubtitle: 'divisionSubtitle',
      dividendLabel: 'dividendLabel',
      divisorLabel: 'divisorLabel',
      divisionHint: 'divisionHint',
      divisionResultLabel: 'divisionResultLabel',
      factorTitle: 'factorTitle',
      factorSubtitle: 'factorSubtitle',
      multiplyTitle: 'multiplyTitle',
      multiplySubtitle: 'multiplySubtitle',
      multiplicandLabel: 'multiplicandLabel',
      multiplierLabel: 'multiplierLabel',
      multiplyHint: 'multiplyHint',
      multiplyResultLabel: 'multiplyResultLabel',
      multiplyDetailsTitle: 'multiplyDetailsTitle'
    };

    function applyLanguage(lang) {
      const t = translations[lang] || translations.en;
      for (const key in textIds) {
        const el = document.getElementById(textIds[key]);
        if (el && t[key]) {
          el.textContent = t[key];
        }
      }
    }

    languageSelect.addEventListener('change', () => {
      applyLanguage(languageSelect.value);
    });

    // Initialize language
    applyLanguage('en');

    // ---------- TAB SWITCHING ----------
    tabDivision.addEventListener('click', () => {
      tabDivision.classList.add('active');
      tabMultiply.classList.remove('active');
      divisionSection.style.display = '';
      multiplySection.style.display = 'none';
    });

    tabMultiply.addEventListener('click', () => {
      tabMultiply.classList.add('active');
      tabDivision.classList.remove('active');
      multiplySection.style.display = '';
      divisionSection.style.display = 'none';
    });

    // ---------- DIVISION LOGIC ----------
    function clearDivisionOutputs() {
      divisionError.style.display = 'none';
      divisionError.textContent = '';
      divisionResult.style.display = 'none';
      factorsBox.style.display = 'none';
      divisionEquation.textContent = '';
      divisionStory.textContent = '';
      divisionTimes.textContent = '';
      factorList.innerHTML = '';
    }

    function clearDivisionInputs() {
      dividendInput.value = '';
      divisorInput.value = '';
      clearDivisionOutputs();
    }

    function calculateDivision() {
      clearDivisionOutputs();
      const lang = languageSelect.value;
      const t = translations[lang];

      const dividend = parseInt(dividendInput.value, 10);
      const divisor = parseInt(divisorInput.value, 10);

      if (isNaN(dividend) || isNaN(divisor)) {
        divisionError.style.display = 'block';
        divisionError.textContent = t.errors.bothNumbers;
        return;
      }
      if (dividend <= 0 || divisor <= 0) {
        divisionError.style.display = 'block';
        divisionError.textContent = t.errors.positive;
        return;
      }

      const quotient = Math.floor(dividend / divisor);
      const remainder = dividend % divisor;

      const eq = `${dividend} √∑ ${divisor} = ${quotient}` +
        (remainder ? ` (remainder ${remainder})` : '');
      divisionEquation.textContent = eq;

      const story = remainder === 0
        ? t.divisionStoryNoRemainder(dividend, divisor, quotient)
        : t.divisionStoryRemainder(dividend, divisor, quotient, remainder);
      divisionStory.textContent = story;

      if (remainder === 0) {
        divisionTimes.textContent = t.divisionTimesNoRemainder(divisor, quotient, dividend);
      } else {
        divisionTimes.textContent = t.divisionTimesRemainder(divisor, quotient, dividend);
      }

      divisionResult.style.display = 'block';

      // Factor pairs
      const n = dividend;
      const pairs = [];
      for (let i = 1; i * i <= n; i++) {
        if (n % i === 0) {
          const j = n / i;
          pairs.push([i, j]);
        }
      }

      factorList.innerHTML = '';
      pairs.forEach(([a, b]) => {
        const item = document.createElement('div');
        item.className = 'factor-item';

        const mult = document.createElement('span');
        mult.className = 'equation-pill';
        mult.textContent = `${a} √ó ${b} = ${n}`;

        const arrow = document.createElement('span');
        arrow.textContent = '‚Üí';

        const div1 = document.createElement('span');
        div1.className = 'equation-pill';
        div1.textContent = `${n} √∑ ${a} = ${b}`;

        const div2 = document.createElement('span');
        div2.className = 'equation-pill';
        div2.textContent = `${n} √∑ ${b} = ${a}`;

        item.appendChild(mult);
        item.appendChild(arrow);
        item.appendChild(div1);
        item.appendChild(div2);
        factorList.appendChild(item);
      });

      factorsBox.style.display = 'block';
    }

    divisionCalcBtn.addEventListener('click', calculateDivision);
    divisionClearBtn.addEventListener('click', clearDivisionInputs);
    dividendInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') calculateDivision();
    });
    divisorInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') calculateDivision();
    });

    // ---------- MULTIPLICATION LOGIC ----------
    function clearMultiplyOutputs() {
      multiplyError.style.display = 'none';
      multiplyError.textContent = '';
      multiplyResult.style.display = 'none';
      multiplyDetails.style.display = 'none';
      multiplyEquation.textContent = '';
      multiplyStory.textContent = '';
      multiplyDetailsList.innerHTML = '';
    }

    function clearMultiplyInputs() {
      multiplicandInput.value = '';
      multiplierInput.value = '';
      clearMultiplyOutputs();
    }

    function calculateMultiply() {
      clearMultiplyOutputs();
      const lang = languageSelect.value;
      const t = translations[lang];

      const a = parseInt(multiplicandInput.value, 10);
      const b = parseInt(multiplierInput.value, 10);

      if (isNaN(a) || isNaN(b)) {
        multiplyError.style.display = 'block';
        multiplyError.textContent = t.errors.bothNumbers;
        return;
      }
      if (a < 0 || b < 0) {
        multiplyError.style.display = 'block';
        multiplyError.textContent = t.errors.positive;
        return;
      }

      const product = a * b;
      const eq = `${a} √ó ${b} = ${product}`;
      multiplyEquation.textContent = eq;
      multiplyStory.textContent = t.multiplyStory(a, b, product);
      multiplyResult.style.display = 'block';

      // Add detailed explanations
      multiplyDetailsList.innerHTML = '';
      
      // Commutative property
      const detail1 = document.createElement('div');
      detail1.className = 'detail-row';
      detail1.innerHTML = `<span class="equation-pill">${t.multiplyDetailsCommutative(a, b, product)}</span>`;
      multiplyDetailsList.appendChild(detail1);

      // Repeated addition
      const detail2 = document.createElement('div');
      detail2.className = 'detail-row';
      const additionSeq = Array(Math.min(b, 10)).fill(a).join(' + ') + (b > 10 ? ' + ...' : '');
      detail2.innerHTML = `<span class="equation-pill">${t.multiplyDetailsRepeated(a, b)}</span><br><span style="margin-left: 20px; font-size: 0.85rem;">${additionSeq} = ${product}</span>`;
      multiplyDetailsList.appendChild(detail2);

      // Skip counting
      if (b <= 15) {
        const detail3 = document.createElement('div');
        detail3.className = 'detail-row';
        const skipSeq = Array.from({length: b}, (_, i) => a * (i + 1)).join(', ');
        detail3.innerHTML = `<span class="equation-pill">${t.multiplyDetailsSkip(a, b)}</span><br><span style="margin-left: 20px; font-size: 0.85rem;">${skipSeq}</span>`;
        multiplyDetailsList.appendChild(detail3);
      }

      // Division check
      if (product > 0) {
        const detail4 = document.createElement('div');
        detail4.className = 'detail-row';
        detail4.innerHTML = `<span class="equation-pill">${t.multiplyDetailsReverse(product, a, b)}</span>`;
        multiplyDetailsList.appendChild(detail4);
      }

      multiplyDetails.style.display = 'block';
    }

    multiplyCalcBtn.addEventListener('click', calculateMultiply);
    multiplyClearBtn.addEventListener('click', clearMultiplyInputs);
    multiplicandInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') calculateMultiply();
    });
    multiplierInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') calculateMultiply();
    });

    // ---------- SPEECH RECOGNITION ----------
    let recognition = null;
    if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      recognition = new SpeechRecognition();
      recognition.interimResults = false;
      recognition.maxAlternatives = 1;
      
      // Function to update recognition language based on selected language
      function updateRecognitionLanguage() {
        if (recognition) {
          const selectedLang = languageSelect.value;
          // Use appropriate language code
          recognition.lang = selectedLang === 'hi' ? 'hi-IN' : 'en-US';
        }
      }
      
      // Set initial language
      updateRecognitionLanguage();
      
      // Update language when user changes selection
      languageSelect.addEventListener('change', updateRecognitionLanguage);
    } else {
      // Browser not supported; disable mic buttons
      divisionMicBtn.disabled = true;
      multiplyMicBtn.disabled = true;
      divisionMicBtn.title = "Speech input not supported in this browser.";
      multiplyMicBtn.title = "Speech input not supported in this browser.";
    }

    function extractTwoNumbers(text) {
      // Handle both English digits and Hindi/Devanagari number words
      const nums = text.match(/\d+/g);
      
      // Also try to extract Hindi number words
      const hindiNumbers = {
        '‡§∂‡•Ç‡§®‡•ç‡§Ø': 0, '‡§è‡§ï': 1, '‡§¶‡•ã': 2, '‡§§‡•Ä‡§®': 3, '‡§ö‡§æ‡§∞': 4, '‡§™‡§æ‡§Ç‡§ö': 5, '‡§õ‡§π': 6, '‡§∏‡§æ‡§§': 7, '‡§Ü‡§†': 8, '‡§®‡•å': 9,
        '‡§¶‡§∏': 10, '‡§ó‡•ç‡§Ø‡§æ‡§∞‡§π': 11, '‡§¨‡§æ‡§∞‡§π': 12, '‡§§‡•á‡§∞‡§π': 13, '‡§ö‡•å‡§¶‡§π': 14, '‡§™‡§Ç‡§¶‡•ç‡§∞‡§π': 15, '‡§∏‡•ã‡§≤‡§π': 16, '‡§∏‡§§‡•ç‡§∞‡§π': 17, '‡§Ö‡§†‡§æ‡§∞‡§π': 18, '‡§â‡§®‡•ç‡§®‡•Ä‡§∏': 19,
        '‡§¨‡•Ä‡§∏': 20, '‡§§‡•Ä‡§∏': 30, '‡§ö‡§æ‡§≤‡•Ä‡§∏': 40, '‡§™‡§ö‡§æ‡§∏': 50, '‡§∏‡§æ‡§†': 60, '‡§∏‡§§‡•ç‡§§‡§∞': 70, '‡§Ö‡§∏‡•ç‡§∏‡•Ä': 80, '‡§®‡§¨‡•ç‡§¨‡•á': 90, '‡§∏‡•å': 100
      };
      
      let extractedNums = [];
      
      // First, try to get numeric digits
      if (nums && nums.length >= 2) {
        extractedNums = [parseInt(nums[0], 10), parseInt(nums[1], 10)];
      } else {
        // Try to extract Hindi number words
        const words = text.split(/\s+/);
        for (let word of words) {
          const cleaned = word.trim().toLowerCase();
          if (hindiNumbers[cleaned] !== undefined) {
            extractedNums.push(hindiNumbers[cleaned]);
          }
        }
      }
      
      if (extractedNums.length < 2) return null;
      return [extractedNums[0], extractedNums[1]];
    }

    function startDivisionSpeech() {
      if (!recognition) return;
      clearDivisionOutputs();
      divisionError.style.display = 'none';

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.toLowerCase();
        const numbers = extractTwoNumbers(transcript);
        if (!numbers) {
          divisionError.style.display = 'block';
          divisionError.textContent = "I couldn't hear two numbers. Try saying \"100 divided by 4\".";
          return;
        }
        const [dividend, divisor] = numbers;
        dividendInput.value = dividend;
        divisorInput.value = divisor;
        calculateDivision();
      };

      recognition.onerror = (event) => {
        divisionError.style.display = 'block';
        divisionError.textContent = "Speech error: " + event.error;
      };

      recognition.start();
    }

    function startMultiplySpeech() {
      if (!recognition) return;
      clearMultiplyOutputs();
      multiplyError.style.display = 'none';

      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.toLowerCase();
        const numbers = extractTwoNumbers(transcript);
        if (!numbers) {
          multiplyError.style.display = 'block';
          multiplyError.textContent = "I couldn't hear two numbers. Try saying \"12 times 7\".";
          return;
        }
        const [a, b] = numbers;
        multiplicandInput.value = a;
        multiplierInput.value = b;
        calculateMultiply();
      };

      recognition.onerror = (event) => {
        multiplyError.style.display = 'block';
        multiplyError.textContent = "Speech error: " + event.error;
      };

      recognition.start();
    }

    divisionMicBtn.addEventListener('click', startDivisionSpeech);
    multiplyMicBtn.addEventListener('click', startMultiplySpeech);
  </script>
</body>
</html>
